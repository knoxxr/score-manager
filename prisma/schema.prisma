generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

model Teacher {
  id        Int      @id @default(autoincrement())
  name      String
  grade     Int
  class     String   @default("대시") // Default for migration
  students  Student[]
  user      User?

  @@unique([grade, class])
}

model User {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  password  String
  role      String   // "ADMIN" | "TEACHER"
  teacherId Int?     @unique
  teacher   Teacher? @relation(fields: [teacherId], references: [id])
}

model Student {
  id          Int       @id
  name        String
  grade       Int
  class       String    @default("대시") // Default for migration
  phoneNumber String
  teacherId   Int?
  teacher     Teacher?  @relation(fields: [teacherId], references: [id])
  examRecords ExamRecord[]
}

model Exam {
  id          Int      @id @default(autoincrement())
  name        String
  grade       Int
  date        DateTime
  subjectInfo String   // JSON: Question details (number, type, score, answer)
  records     ExamRecord[]
}

model ExamRecord {
  id             Int      @id @default(autoincrement())
  examId         Int
  studentId      Int
  exam           Exam     @relation(fields: [examId], references: [id])
  student        Student  @relation(fields: [studentId], references: [id])
  studentAnswers String   // JSON: Map of Question No -> Student Answer
  totalScore     Int
  typeScores     String   // JSON: Score breakdown by assignment type

  @@unique([examId, studentId])
}
