generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

model Teacher {
  id          Int      @id @default(autoincrement())
  name        String
  assignments TeacherAssignment[]
  students    Student[]
  user        User?
}

model TeacherAssignment {
  id        Int     @id @default(autoincrement())
  teacherId Int
  grade     Int
  class     String
  teacher   Teacher @relation(fields: [teacherId], references: [id], onDelete: Cascade)

  @@unique([grade, class])
}

model User {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  password  String
  role      String   // "ADMIN" | "TEACHER"
  teacherId Int?     @unique
  teacher   Teacher? @relation(fields: [teacherId], references: [id])
}

model Student {
  id          String    @id
  name        String
  grade       Int
  class       String    @default("대시") // Default for migration
  phoneNumber String
  schoolName  String?
  teacherId   Int?
  teacher     Teacher?  @relation(fields: [teacherId], references: [id])
  examRecords ExamRecord[]
}

model Exam {
  id          Int      @id @default(autoincrement())
  name        String
  grade       Int
  class       String   @default("대시")
  type        String   @default("NORMAL") // "NORMAL" | "VOCAB"
  date        DateTime
  subjectInfo String   // JSON: Question details (number, type, score, answer)
  gradeCutoffs String   @default("{}") // JSON: Grade (1-9) -> Min Score
  isAdmission Boolean  @default(false)
  records     ExamRecord[]
}

model ExamRecord {
  id             Int       @id @default(autoincrement())
  examId         Int
  studentId      String
  exam           Exam      @relation(fields: [examId], references: [id], onDelete: Cascade)
  student        Student   @relation(fields: [studentId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  studentAnswers String    // JSON: Map of Question No -> Student Answer
  totalScore     Int
  vocabScore     Int       @default(0)
  typeScores     String    // JSON: Score breakdown by assignment type
  remarks        String?   @default("")  // Optional remarks/notes for this exam record
  testDate       DateTime? // Optional: Test date for admission exams

  @@unique([examId, studentId])
}

model QuestionType {
  id    Int    @id @default(autoincrement())
  name  String @unique
  order Int    @default(0)
}